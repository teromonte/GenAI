# Architecture Visual Diagram

## ğŸ—ï¸ System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT (Frontend)                        â”‚
â”‚                    React/Next.js Application                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTP Requests (JSON)
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FastAPI Application                          â”‚
â”‚                      (app/main.py)                               â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Middleware Layer                             â”‚   â”‚
â”‚  â”‚  â€¢ Request logging                                        â”‚   â”‚
â”‚  â”‚  â€¢ Request ID generation                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              API Router Layer                             â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚  â”‚  auth.py â”‚  â”‚ chat.py   â”‚  â”‚feeds.py  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚          â”‚  â”‚           â”‚  â”‚          â”‚               â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ signup â”‚  â”‚ â€¢ /chat   â”‚  â”‚ â€¢ create â”‚               â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ login  â”‚  â”‚ â€¢ /stream â”‚  â”‚ â€¢ list   â”‚               â”‚   â”‚
â”‚  â”‚  â”‚          â”‚  â”‚ â€¢ history â”‚  â”‚ â€¢ delete â”‚               â”‚   â”‚
â”‚  â”‚  â”‚          â”‚  â”‚           â”‚  â”‚ â€¢ refreshâ”‚               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚       â”‚              â”‚              â”‚                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚              â”‚              â”‚                          â”‚
â”‚          â”‚              â”‚              â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Dependencies Layer                             â”‚   â”‚
â”‚  â”‚  â€¢ get_current_user() - JWT validation                     â”‚   â”‚
â”‚  â”‚  â€¢ get_db() - Database session                             â”‚   â”‚
â”‚  â”‚  â€¢ get_rag_service() - RAG service instance                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Services    â”‚   â”‚   Database    â”‚   â”‚  Vector Store â”‚
â”‚    Layer      â”‚   â”‚     Layer     â”‚   â”‚     Layer     â”‚
â”‚               â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚RAGService â”‚ â”‚   â”‚ â”‚  Models   â”‚ â”‚   â”‚ â”‚ ChromaDB  â”‚ â”‚
â”‚ â”‚           â”‚ â”‚   â”‚ â”‚           â”‚ â”‚   â”‚ â”‚           â”‚ â”‚
â”‚ â”‚ â€¢ ask_q() â”‚ â”‚   â”‚ â”‚ â€¢ User    â”‚ â”‚   â”‚ â”‚ â€¢ Embed   â”‚ â”‚
â”‚ â”‚ â€¢ stream  â”‚ â”‚   â”‚ â”‚ â€¢ Feed    â”‚ â”‚   â”‚ â”‚ â€¢ Search  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â”‚ â€¢ Article â”‚ â”‚   â”‚ â”‚ â€¢ Retrieveâ”‚ â”‚
â”‚       â”‚       â”‚   â”‚ â”‚ â€¢ History â”‚ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚               â”‚
â”‚ â”‚FeedServiceâ”‚ â”‚   â”‚               â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚           â”‚ â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”‚Embeddingsâ”‚ â”‚
â”‚ â”‚ â€¢ create  â”‚ â”‚   â”‚ â”‚ Session   â”‚ â”‚   â”‚ â”‚           â”‚ â”‚
â”‚ â”‚ â€¢ update  â”‚ â”‚   â”‚ â”‚           â”‚ â”‚   â”‚ â”‚ Hugging   â”‚ â”‚
â”‚ â”‚ â€¢ delete  â”‚ â”‚   â”‚ â”‚ â€¢ get_db()â”‚ â”‚   â”‚ â”‚ Face      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚       â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”‚RSSFetcher â”‚ â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”‚           â”‚ â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”‚ â€¢ fetch() â”‚ â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚               â”‚   â”‚               â”‚
â”‚               â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”‚Vector     â”‚ â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”‚Service    â”‚ â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”‚           â”‚ â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”‚ â€¢ add()   â”‚ â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”‚ â€¢ get()   â”‚ â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚               â”‚   â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â”‚                    â”‚                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  External APIs â”‚
                    â”‚               â”‚
                    â”‚ â€¢ Groq LLM    â”‚
                    â”‚ â€¢ LangSmith   â”‚
                    â”‚ â€¢ RSS Feeds   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Request Flow: Chat Endpoint

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ POST /api/chat
     â”‚ {"question": "What's the news?"}
     â”‚ Authorization: Bearer <token>
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI Router     â”‚
â”‚  (chat.py)          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Authentication
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ get_current_user()  â”‚
â”‚ â€¢ Extract token     â”‚
â”‚ â€¢ Validate JWT      â”‚
â”‚ â€¢ Query User from DBâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Returns: User object
     â”‚
     â”‚ 2. Database Session
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ get_db()            â”‚
â”‚ â€¢ Create session    â”‚
â”‚ â€¢ Yield to route    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Returns: DB session
     â”‚
     â”‚ 3. RAG Service
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ get_rag_service()   â”‚
â”‚ â€¢ Returns RAGServiceâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. Process Question
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RAGService          â”‚
â”‚ .ask_question()     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                 â”‚
     â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retrieve â”‚    â”‚   Generate   â”‚
â”‚          â”‚    â”‚              â”‚
â”‚ Vector   â”‚    â”‚  ChatGroq    â”‚
â”‚ Service  â”‚    â”‚  LLM         â”‚
â”‚          â”‚    â”‚              â”‚
â”‚ â€¢ Search â”‚    â”‚ â€¢ Create     â”‚
â”‚ â€¢ Find   â”‚    â”‚   answer     â”‚
â”‚ â€¢ Top 5  â”‚    â”‚   from       â”‚
â”‚ articles â”‚    â”‚   context    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Returns: answer + docs
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Save to Database    â”‚
â”‚                     â”‚
â”‚ ChatHistory:        â”‚
â”‚ â€¢ question          â”‚
â”‚ â€¢ answer            â”‚
â”‚ â€¢ user_id           â”‚
â”‚ â€¢ timestamp         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 5. Return Response
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatResponse        â”‚
â”‚ {                   â”‚
â”‚   answer: "...",    â”‚
â”‚   source_docs: [...],â”‚
â”‚   history_id: 123   â”‚
â”‚ }                   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Database Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚
â”‚             â”‚
â”‚ â€¢ id (PK)   â”‚
â”‚ â€¢ email     â”‚
â”‚ â€¢ password  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N (one user has many)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ChatHistory  â”‚
â”‚             â”‚
â”‚ â€¢ id (PK)   â”‚
â”‚ â€¢ user_id   â”‚â—„â”€â”€â”€â”
â”‚ â€¢ question  â”‚    â”‚
â”‚ â€¢ answer    â”‚    â”‚
â”‚ â€¢ timestamp â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    Feed     â”‚    â”‚
â”‚             â”‚    â”‚
â”‚ â€¢ id (PK)   â”‚    â”‚
â”‚ â€¢ name      â”‚    â”‚
â”‚ â€¢ url       â”‚    â”‚
â”‚ â€¢ category  â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚
       â”‚           â”‚
       â”‚ 1:N       â”‚
       â”‚           â”‚
       â–¼           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   Article   â”‚   â”‚
â”‚             â”‚   â”‚
â”‚ â€¢ id (PK)   â”‚   â”‚
â”‚ â€¢ feed_id   â”‚â”€â”€â”€â”˜
â”‚ â€¢ title     â”‚
â”‚ â€¢ content   â”‚
â”‚ â€¢ url       â”‚
â”‚ â€¢ published â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ POST /api/auth/signup
     â”‚ {email, password}
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ auth.py router      â”‚
â”‚ create_user()       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Hash password
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ security.py         â”‚
â”‚ get_password_hash() â”‚
â”‚ â€¢ bcrypt hash       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Save to DB
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User table          â”‚
â”‚ â€¢ email             â”‚
â”‚ â€¢ hashed_password   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ POST /api/auth/token
     â”‚ {username: email, password}
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ auth.py router      â”‚
â”‚ login_for_access_   â”‚
â”‚   token()           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Verify password
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ security.py         â”‚
â”‚ verify_password()   â”‚
â”‚ â€¢ Compare hash      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Create token
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ security.py         â”‚
â”‚ create_access_token()â”‚
â”‚ â€¢ JWT with email    â”‚
â”‚ â€¢ Expires in 30 min â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Return token
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚
â”‚ (stores â”‚
â”‚  token) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ POST /api/chat
     â”‚ Authorization: Bearer <token>
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ deps.py            â”‚
â”‚ get_current_user() â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Decode & validate
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ security.py         â”‚
â”‚ jwt.decode()        â”‚
â”‚ â€¢ Verify signature  â”‚
â”‚ â€¢ Check expiration  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Query user
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User table          â”‚
â”‚ â€¢ Find by email     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Return User object
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Route handler       â”‚
â”‚ (has access to user)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“° Feed Processing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ POST /api/feeds/{id}/refresh
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ feeds.py router     â”‚
â”‚ refresh_feed()      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Call service
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FeedService         â”‚
â”‚ update_feed_articles()â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Fetch RSS
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RSSFetcher          â”‚
â”‚ .fetch(url)         â”‚
â”‚ â€¢ Parse RSS feed    â”‚
â”‚ â€¢ Return entries    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Process each entry
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ For each article:   â”‚
â”‚                     â”‚
â”‚ â€¢ Check if exists   â”‚
â”‚ â€¢ Create Article    â”‚
â”‚ â€¢ Save to PostgreSQLâ”‚
â”‚ â€¢ Create Document   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. Embed articles
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VectorService       â”‚
â”‚ .add_documents()    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                 â”‚
     â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Embed    â”‚    â”‚   ChromaDB   â”‚
â”‚          â”‚    â”‚              â”‚
â”‚ Hugging  â”‚    â”‚ â€¢ Store      â”‚
â”‚ Face     â”‚    â”‚   vectors    â”‚
â”‚ Model    â”‚    â”‚ â€¢ Index      â”‚
â”‚          â”‚    â”‚   for search â”‚
â”‚ Text â†’   â”‚    â”‚              â”‚
â”‚ Vector   â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§  RAG Pipeline Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User    â”‚
â”‚ Questionâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ "What's happening in Brazil?"
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RAGService          â”‚
â”‚ .ask_question()     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Step 1: RETRIEVE
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VectorService       â”‚
â”‚ .get_retriever()    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Search vector DB
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChromaDB            â”‚
â”‚                     â”‚
â”‚ â€¢ Convert question  â”‚
â”‚   to vector         â”‚
â”‚ â€¢ Find similar      â”‚
â”‚   article vectors   â”‚
â”‚ â€¢ Return top 5      â”‚
â”‚   articles          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Returns: [Article1, Article2, ...]
     â”‚
     â”‚ Step 2: AUGMENT
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Build Prompt        â”‚
â”‚                     â”‚
â”‚ Context:            â”‚
â”‚ [Article1 content]  â”‚
â”‚ [Article2 content]  â”‚
â”‚ ...                 â”‚
â”‚                     â”‚
â”‚ Question:           â”‚
â”‚ "What's happening   â”‚
â”‚  in Brazil?"        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Step 3: GENERATE
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatGroq (LLM)      â”‚
â”‚                     â”‚
â”‚ â€¢ Reads context     â”‚
â”‚ â€¢ Understands       â”‚
â”‚   question          â”‚
â”‚ â€¢ Generates answer  â”‚
â”‚   based on context  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Returns: Answer text
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response            â”‚
â”‚ {                   â”‚
â”‚   answer: "...",    â”‚
â”‚   source_docs: [...]â”‚
â”‚ }                   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Class Dependencies

```
RAGService
â”œâ”€â”€ VectorService
â”‚   â”œâ”€â”€ ChromaDB
â”‚   â””â”€â”€ HuggingFaceEmbeddings
â”œâ”€â”€ ChatGroq (LLM)
â””â”€â”€ Prompts (from YAML)

FeedService
â”œâ”€â”€ RSSFetcher
â”‚   â””â”€â”€ feedparser library
â”œâ”€â”€ VectorService
â”‚   â””â”€â”€ (same as above)
â””â”€â”€ Database Session
    â””â”€â”€ SQLAlchemy

auth.py router
â”œâ”€â”€ security.py
â”‚   â”œâ”€â”€ bcrypt (password hashing)
â”‚   â””â”€â”€ jose (JWT)
â””â”€â”€ Database Session
    â””â”€â”€ User model

chat.py router
â”œâ”€â”€ get_current_user (from deps.py)
â”‚   â”œâ”€â”€ JWT validation
â”‚   â””â”€â”€ User model
â”œâ”€â”€ get_db (from session.py)
â”‚   â””â”€â”€ PostgreSQL
â””â”€â”€ RAGService
    â””â”€â”€ (see above)
```

---

## ğŸ”§ Configuration Flow

```
Application Startup
â”‚
â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ setup_logging()
â”‚   â”‚   â””â”€â”€ structlog configuration
â”‚   â”‚
â”‚   â”œâ”€â”€ Load environment variables
â”‚   â”‚   â””â”€â”€ LangSmith, API keys
â”‚   â”‚
â”‚   â””â”€â”€ Create FastAPI app
â”‚       â””â”€â”€ Include routers
â”‚
â”œâ”€â”€ config.py
â”‚   â””â”€â”€ Settings class
â”‚       â”œâ”€â”€ Load from .env
â”‚       â”œâ”€â”€ Database URI
â”‚       â”œâ”€â”€ API keys
â”‚       â””â”€â”€ Model names
â”‚
â””â”€â”€ session.py
    â””â”€â”€ Create database engine
        â””â”€â”€ Connection pool ready
```

---

This visual guide complements the detailed architecture document and helps you see how all the pieces fit together!

